# 📈 ST (System Trading) v0.1 - 개발 TODO 리스트

## 🎯 **프로젝트 개요**
- **목표**: 스윙 매매 기반 한국 주식 자동매매 시스템
- **핵심**: 10초 단위 Stop Loss/Take Profit 실시간 모니터링
- **최대 보유**: 20개 종목 동시 관리
- **데이터**: FinanceDataReader, pykrx, 한국투자증권 API

---

## 📋 **개발 단계별 TODO**

### **🏗️ Phase 1: 아키텍처 설계 & 리팩토링** ✅ **COMPLETED**

#### ✅ **1.1 기존 코드 분석 및 SW 아키텍처 설계** `[COMPLETED]`
- [x] 기존 모듈별 역할 분석 완료
- [x] 새로운 디렉토리 구조 설계
- [x] 데이터 플로우 설계
- [x] API 엔드포인트 설계

#### ✅ **1.2 메인 실행 코드 작성** `[COMPLETED]`
- [x] `main.py` 작성 (전체 시스템 오케스트레이션)
- [x] 시스템 초기화 로직
- [x] 모듈 간 의존성 관리
- [x] 설정 파일 로딩 및 검증

#### ✅ **1.3 기존 모듈 리팩토링** `[COMPLETED]`
- [x] `UnifiedDataProvider` 통합 클래스 생성
- [x] `RiskManager` 클래스 신규 생성
- [x] 공통 인터페이스 정의
- [x] config.yaml 구체화

---

### **⚙️ Phase 2: 백테스팅 엔진 & 웹 시각화** ✅ **COMPLETED**

#### ✅ **2.1 새로운 백테스팅 엔진** `[COMPLETED]`
- [x] **BacktestEngine 클래스**
  - [x] 다양한 전략 지원 (볼린저밴드, RSI, 이동평균교차)
  - [x] 상세한 성과 분석 (수익률, 승률, 샤프비율, 최대낙폭)
  - [x] 리스크 관리 통합 (포지션 크기, 수수료)
  - [x] 거래 내역 추적 (진입/청산 이유, 수익률)

#### ✅ **2.2 전략 시스템** `[COMPLETED]`
- [x] **BaseStrategy 추상 클래스**
- [x] **샘플 전략들**
  - [x] BollingerBandStrategy
  - [x] RSIStrategy  
  - [x] MovingAverageCrossStrategy
- [x] 동적 파라미터 조정 시스템

#### ✅ **2.3 웹 기반 시각화** `[COMPLETED]`
- [x] **FastAPI 백엔드**
  - [x] 백테스트 API (`/api/backtest/`)
  - [x] 데이터 API (`/api/data/`)
  - [x] 전략 API (`/api/strategy/`)
- [x] **웹 인터페이스**
  - [x] 대시보드 (`/`)
  - [x] 백테스팅 페이지 (`/backtest`)
  - [x] 전략 관리 페이지 (`/strategy`)

#### ✅ **2.4 전략 설정 변경 UI** `[COMPLETED]`
- [x] **동적 파라미터 조정**
  - [x] 실시간 파라미터 변경
  - [x] 파라미터 유효성 검증
  - [x] 전략 저장/로드 시스템
- [x] **실시간 미리보기**
  - [x] 파라미터 변경 시 즉시 반영
  - [x] 예상 신호 및 거래 수 표시
  - [x] 시각적 피드백

---

### **🔍 Phase 3: 종목 발굴 & 전략 시스템** 🔄 **IN_PROGRESS**

#### ✅ **3.1 종목 발굴 시스템 통합** `[COMPLETED]`
- [x] **재무제표 기반 종목 스크리닝** (finance_score.py)
  - [x] 네이버 재무제표 크롤링
  - [x] 재무 점수 계산 알고리즘 
  - [x] 멀티프로세싱 기반 성능 최적화
- [x] **종목 검색 및 테마/업종 분석** (search_stocks.py)
  - [x] 네이버 주식 테마/업종 크롤링
  - [x] 종목별 상태 확인 및 필터링
  - [x] 매수 조건 만족 종목 자동 선별
- [x] **거시경제 분석** (search_macro.py)
  - [x] ETF 기반 거시경제 지표 분석
  - [x] 시장 상황 판단 알고리즘
  - [x] 분석 결과 반환 기능 추가
- [x] **main.py 통합**
  - [x] 종목 발굴 프로세스 통합 (discovery 모드)
  - [x] 설정 기반 자동 실행
  - [x] 결과 데이터 표준화 및 리포트 생성

#### ✅ **3.2 전략 시스템 리팩토링** `[COMPLETED]`
- [x] **system_trade.py 리팩토링**
  - [x] 하드코딩된 전략 로직 분리
  - [x] 설정 기반 전략 실행 시스템
  - [x] main.py와의 통합 (trading 모드)
- [x] **BaseStrategy 상속 구조**
  - [x] 전략 베이스 클래스 설계 (BaseTradingStrategy)
  - [x] 기존 전략들 method화 (볼린저밴드, RSI, 복합전략)
  - [x] 전략 파일 시스템 구축
- [x] **거래 엔진 시스템**
  - [x] TradingEngine 클래스 구현
  - [x] 실시간 포지션 관리
  - [x] 리스크 관리 시스템
  - [x] 신호 생성 및 실행 시스템

#### ✅ **3.3 웹 UI 확장** `[COMPLETED]`
- [x] **종목 발굴 페이지**
  - [x] 종목 발굴 실행 인터페이스
  - [x] 거시경제 분석 결과 표시
  - [x] 후보 종목 목록 및 상세 정보
  - [x] 섹터별 분석 차트
- [x] **API 라우트 구축**
  - [x] /api/discovery/* 엔드포인트
  - [x] 백그라운드 작업 처리
  - [x] 리포트 관리 시스템

---

### **🌐 Phase 4: 백엔드 서버 구축** ✅ **COMPLETED**

#### ✅ **4.1 FastAPI 백엔드 서버** `[COMPLETED]`
- [x] **기본 서버 구조**
  - [x] FastAPI 앱 초기화
  - [x] 미들웨어 설정 (CORS, 로깅)
  - [x] 예외 처리 핸들러
- [x] **API 엔드포인트**
  - [x] `/api/backtest` - 백테스팅
  - [x] `/api/data` - 데이터 조회
  - [x] `/api/strategy` - 전략 관리
  - [x] 전략 저장/로드 기능

#### **4.2 실시간 WebSocket** `[PENDING]`
- [ ] 실시간 포트폴리오 업데이트
- [ ] 거래 신호 브로드캐스트
- [ ] 시스템 상태 모니터링
- [ ] 에러 알림

---

### **⚡ Phase 5: 실시간 거래 엔진** `[PENDING]`

#### **5.1 실시간 모니터링** `[HIGH_PRIORITY]`
- [ ] **10초 단위 체크 루프**
  - [ ] 포지션별 Stop Loss 모니터링
  - [ ] Take Profit 조건 확인
  - [ ] 실시간 가격 데이터 수신
- [ ] **동적 조건 변경**
  - [ ] 실시간 Stop Loss 수정
  - [ ] Take Profit 목표가 조정
  - [ ] 긴급 매도 기능

#### **5.2 리스크 관리** `[HIGH_PRIORITY]`
- [ ] 최대 20개 종목 제한
- [ ] 포지션 크기 제한
- [ ] 일일 손실 한도
- [ ] 계좌 잔고 모니터링

#### **5.3 한국투자증권 API 연동** `[PENDING]`
- [ ] 실시간 주가 데이터 수신
- [ ] 주문 실행 (매수/매도)
- [ ] 포지션 조회
- [ ] 잔고 확인

---

### **🔔 Phase 6: 알림 & 모니터링** `[PENDING]`

#### **6.1 텔레그램 알림 시스템** `[PENDING]`
- [ ] 매매 신호 알림
- [ ] 포트폴리오 상태 알림
- [ ] 에러 및 시스템 알림
- [ ] 일일 수익률 리포트

#### **6.2 로깅 시스템** `[PENDING]`
- [ ] 구조화된 로깅 (JSON 형태)
- [ ] 실시간 거래 로그 (1-2분 주기)
- [ ] 에러 추적 및 알림
- [ ] 성능 모니터링 로그

---

### **🔐 Phase 7: 보안 & 인증** `[PENDING]`

#### **7.1 인증 시스템** `[PENDING]`
- [ ] 구글 OAuth 2.0 연동
- [ ] JWT 토큰 관리
- [ ] 세션 관리
- [ ] 권한 레벨 관리

#### **7.2 보안 강화** `[PENDING]`
- [ ] API 키 암호화 저장
- [ ] 요청 속도 제한
- [ ] SQL 인젝션 방지
- [ ] XSS 방지

---

### **🗄️ Phase 8: 데이터베이스 & 배포** `[PENDING]`

#### **8.1 데이터베이스** `[PENDING]`
- [ ] SQLite 로컬 DB 설계
- [ ] Supabase 백업 시스템
- [ ] 데이터 마이그레이션
- [ ] 백업/복구 자동화

#### **8.2 Docker & 배포** `[PENDING]`
- [ ] Dockerfile 작성
- [ ] docker-compose.yml 설정
- [ ] 환경변수 관리
- [ ] 클라우드 배포 스크립트

---

## 🚀 **현재 진행 상황 (2024-12-19)**

### ✅ **완료된 기능들**

1. **백테스팅 엔진** - 완전히 새로 구축
   - 다양한 전략 지원 (볼린저밴드, RSI, 이동평균교차)
   - 상세한 성과 분석 및 거래 내역 추적
   - 리스크 관리 및 수수료 고려

2. **웹 기반 시각화** - FastAPI + HTML/JavaScript
   - 대시보드: 포트폴리오 성과, 주요 지표, 실시간 차트
   - 백테스팅 페이지: 전략 설정, 실시간 진행상태, 결과 시각화
   - 전략 관리 페이지: 동적 파라미터 조정, 전략 저장/로드

3. **전략 설정 변경 UI** - 동적 파라미터 조정
   - 실시간 파라미터 변경 및 유효성 검증
   - 전략 저장/로드 시스템
   - 실시간 미리보기 및 시각적 피드백

4. **데이터 통합 시스템**
   - UnifiedDataProvider: 여러 데이터 소스 통합
   - 폴백 메커니즘 및 에러 처리

### 🔄 **현재 실행 중**
- FastAPI 서버: http://localhost:8000
- 웹 인터페이스 접근 가능

### 📁 **새로운 디렉토리 구조**
```
ST_ver0.1/
├── core/
│   ├── engines/          # 백테스팅/트레이딩 엔진
│   ├── strategies/       # 전략 모듈
│   ├── data_providers/   # 데이터 제공자
│   └── risk_management/  # 리스크 관리
├── api/
│   ├── main.py          # FastAPI 메인 앱
│   └── routes/          # API 라우트
├── frontend/
│   ├── templates/       # HTML 템플릿
│   └── static/          # 정적 파일
├── config/
│   ├── strategies/      # 저장된 전략 설정
│   └── config.yaml      # 메인 설정
└── tools/
    └── test_backtest.py # 테스트 스크립트
```

---

## 🎯 **다음 우선순위**

1. **실시간 포트폴리오 모니터링** (WebSocket 기반)
2. **실시간 거래 신호 알림** (텔레그램 연동)  
3. **한국투자증권 API 실거래 연동**
4. **실시간 거래 엔진** (10초 단위 Stop Loss/Take Profit)

---

## 📌 **주요 기술 스택**

- **Backend**: FastAPI, SQLite, Supabase
- **Frontend**: HTML/JavaScript, Bootstrap, Chart.js
- **Real-time**: WebSocket (예정)
- **Data**: FinanceDataReader, pykrx, 한국투자증권 API
- **Deployment**: Docker (예정)
- **Monitoring**: Custom Logging, Telegram Bot (예정)

---

## ⚠️ **중요 고려사항**

1. **실시간 성능**: 10초 단위 체크 시 API 호출 최적화 필요
2. **에러 처리**: 네트워크 장애 시 폴백 메커니즘
3. **데이터 일관성**: 여러 데이터 소스 간 동기화
4. **보안**: API 키 및 개인정보 보호
5. **확장성**: 향후 기능 추가를 고려한 모듈화

---

**마지막 업데이트**: 2024-12-19  
**다음 업데이트**: Phase 4 (실시간 거래 엔진) 완료 시점